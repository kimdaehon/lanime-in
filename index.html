<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lanime - Anime Streaming</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3a36e0;
            --secondary-color: #ff4081;
            --dark-color: #121212;
            --light-color: #f4f4f4;
            --gray-color: #333;
            --card-bg: #1e1e1e;
            --hover-color: #4a46f0;
            --success-color: #4caf50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--dark-color);
            color: var(--light-color);
            line-height: 1.6;
        }
        
        a {
            text-decoration: none;
            color: var(--light-color);
        }
        
        ul {
            list-style: none;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background-color: rgba(18, 18, 18, 0.95);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .logo span {
            color: var(--secondary-color);
        }
        
        .search-bar {
            display: flex;
            width: 40%;
        }
        
        .search-bar input {
            width: 100%;
            padding: 10px 15px;
            border: none;
            border-radius: 4px 0 0 4px;
            background-color: var(--gray-color);
            color: var(--light-color);
        }
        
        .search-bar button {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .nav-links {
            display: flex;
        }
        
        .nav-links li {
            margin-left: 20px;
        }
        
        .nav-links a {
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: var(--secondary-color);
        }
        
        /* Hero Section */
        .hero {
            margin-top: 80px;
            padding: 60px 0;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://via.placeholder.com/1200x600/333/666?text=Lanime+Anime+Streaming') no-repeat center center/cover;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: var(--hover-color);
        }
        
        /* Category Navigation */
        .category-nav {
            background-color: var(--gray-color);
            padding: 15px 0;
            margin-top: 20px;
        }
        
        .category-links {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 5px 0;
        }
        
        .category-links::-webkit-scrollbar {
            height: 5px;
        }
        
        .category-links::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 5px;
        }
        
        .category-link {
            white-space: nowrap;
            padding: 8px 15px;
            background-color: var(--card-bg);
            border-radius: 20px;
            transition: background-color 0.3s;
        }
        
        .category-link.active, .category-link:hover {
            background-color: var(--primary-color);
        }
        
        /* Anime List */
        .section-title {
            font-size: 1.8rem;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .view-all {
            font-size: 0.9rem;
            color: var(--secondary-color);
        }
        
        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .anime-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .anime-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .anime-card img {
            width: 100%;
            height: 280px;
            object-fit: cover;
        }
        
        .anime-info {
            padding: 15px;
        }
        
        .anime-info h3 {
            font-size: 1rem;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .anime-info p {
            font-size: 0.8rem;
            color: #aaa;
        }
        
        .anime-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        
        .episode-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        .score-badge {
            background-color: var(--success-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }
        
        .page-btn {
            padding: 8px 15px;
            background-color: var(--card-bg);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .page-btn.active, .page-btn:hover {
            background-color: var(--primary-color);
        }
        
        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Anime Detail */
        .anime-detail {
            margin-top: 80px;
            padding: 40px 0;
            display: none;
        }
        
        .detail-container {
            display: flex;
            gap: 30px;
        }
        
        .detail-poster {
            flex: 0 0 300px;
        }
        
        .detail-poster img {
            width: 100%;
            border-radius: 8px;
        }
        
        .detail-content {
            flex: 1;
        }
        
        .detail-content h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .detail-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .meta-item {
            background-color: var(--gray-color);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .detail-synopsis {
            margin-bottom: 20px;
            line-height: 1.7;
        }
        
        .detail-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .genre-tag {
            background-color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .episode-list {
            margin-top: 30px;
        }
        
        .episode-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .episode-card {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            transition: background-color 0.3s;
            cursor: pointer;
        }
        
        .episode-card:hover {
            background-color: var(--primary-color);
        }
        
        /* Player */
        .player {
            margin-top: 80px;
            padding: 40px 0;
            display: none;
        }
        
        .player-container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            background-color: #000;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .episode-nav {
            display: flex;
            gap: 10px;
        }
        
        .episode-nav button {
            padding: 8px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .episode-nav button:hover {
            background-color: var(--hover-color);
        }
        
        .episode-nav button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        
        .server-list {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .server-btn {
            padding: 8px 15px;
            background-color: var(--card-bg);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .server-btn.active, .server-btn:hover {
            background-color: var(--primary-color);
        }
        
        /* Footer */
        footer {
            background-color: var(--gray-color);
            padding: 40px 0;
            margin-top: 60px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .footer-section {
            flex: 1;
            min-width: 250px;
            margin-bottom: 20px;
        }
        
        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .footer-section ul li {
            margin-bottom: 8px;
        }
        
        .footer-section a:hover {
            color: var(--secondary-color);
        }
        
        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #555;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error-message {
            background-color: #ff5252;
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-bar {
                width: 100%;
            }
            
            .nav-links {
                width: 100%;
                justify-content: center;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .detail-container {
                flex-direction: column;
            }
            
            .detail-poster {
                flex: 1;
                max-width: 300px;
                margin: 0 auto;
            }
            
            .player-info {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Lan<span>ime</span></div>
                <div class="search-bar">
                    <input type="text" id="search-input" placeholder="Cari anime...">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <ul class="nav-links">
                    <li><a href="#" id="home-link">Beranda</a></li>
                    <li><a href="#" id="trending-link">Trending</a></li>
                    <li><a href="#" id="popular-link">Populer</a></li>
                </ul>
            </div>
        </div>
    </header>

    <div class="category-nav">
        <div class="container">
            <div class="category-links">
                <a href="#" class="category-link active" data-category="recent">Terbaru</a>
                <a href="#" class="category-link" data-category="ongoing">Sedang Tayang</a>
                <a href="#" class="category-link" data-category="completed">Selesai</a>
                <a href="#" class="category-link" data-category="popular">Populer</a>
                <a href="#" class="category-link" data-category="movies">Movie</a>
                <a href="#" class="category-link" data-category="batch">Batch</a>
            </div>
        </div>
    </div>

    <section class="hero">
        <div class="container">
            <h1>Nonton Anime Gratis</h1>
            <p>Nikmati koleksi anime terlengkap dengan kualitas terbaik. Streaming tanpa iklan dan tanpa batas.</p>
            <a href="#" class="btn" id="explore-btn">Jelajahi Sekarang</a>
        </div>
    </section>

    <main class="container">
        <div class="error-message" id="error-message">
            Terjadi kesalahan saat memuat data. Silakan coba lagi.
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Memuat anime...</p>
        </div>

        <section class="anime-list" id="anime-list">
            <h2 class="section-title" id="section-title">
                Anime Terbaru
                <a href="#" class="view-all" id="view-all">Lihat Semua</a>
            </h2>
            <div class="anime-grid" id="anime-grid">
                </div>
            
            <div class="pagination" id="pagination">
                </div>
        </section>

        <section class="anime-detail" id="anime-detail">
            <div class="detail-container">
                <div class="detail-poster">
                    <img id="detail-poster" src="" alt="Anime Poster">
                </div>
                <div class="detail-content">
                    <h1 id="detail-title">Judul Anime</h1>
                    <div class="detail-meta">
                        <span class="meta-item" id="detail-type">TV</span>
                        <span class="meta-item" id="detail-episodes">12 Episode</span>
                        <span class="meta-item" id="detail-status">Selesai</span>
                        <span class="meta-item" id="detail-score">8.5</span>
                    </div>
                    <div class="detail-genres" id="detail-genres">
                        </div>
                    <div class="detail-synopsis" id="detail-synopsis">
                        Sinopsis anime akan ditampilkan di sini.
                    </div>
                    <div class="episode-list">
                        <h3>Daftar Episode</h3>
                        <div class="episode-grid" id="episode-grid">
                            </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="player" id="player">
            <div class="player-container">
                <div class="video-container">
                    <iframe id="video-player" src="" allowfullscreen></iframe>
                </div>
                <div class="player-info">
                    <h3 id="player-title">Episode 1</h3>
                    <div class="episode-nav">
                        <button id="prev-episode" disabled><i class="fas fa-chevron-left"></i> Sebelumnya</button>
                        <button id="next-episode">Selanjutnya <i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="server-list" id="server-list">
                    </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Tentang Lanime</h3>
                    <p>Lanime adalah platform streaming anime gratis dengan koleksi terlengkap dan kualitas terbaik.</p>
                </div>
                <div class="footer-section">
                    <h3>Kategori</h3>
                    <ul>
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Adventure</a></li>
                        <li><a href="#">Comedy</a></li>
                        <li><a href="#">Drama</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Bantuan</h3>
                    <ul>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Kontak</a></li>
                        <li><a href="#">Syarat & Ketentuan</a></li>
                        <li><a href="#">Kebijakan Privasi</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Lanime. Semua hak cipta dilindungi.</p>
            </div>
        </div>
    </footer>

    <script>
        // ======================================================
        // PERUBAHAN 1: API_BASE_URL diganti untuk menunjuk ke proxy
        // ======================================================
        const API_BASE_URL = '/api/get'; // Arahkan ke backend proxy Anda
        
        // State Management
        let currentAnimeList = [];
        let currentAnimeDetail = null;
        let currentEpisodes = [];
        let currentEpisodeIndex = 0;
        let currentServers = [];
        let currentCategory = 'recent';
        let currentPage = 1;
        let totalPages = 1;

        // DOM Elements
        const animeListSection = document.getElementById('anime-list');
        const animeDetailSection = document.getElementById('anime-detail');
        const playerSection = document.getElementById('player');
        const animeGrid = document.getElementById('anime-grid');
        const sectionTitle = document.getElementById('section-title');
        const viewAllLink = document.getElementById('view-all');
        const loadingElement = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const paginationElement = document.getElementById('pagination');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const homeLink = document.getElementById('home-link');
        const trendingLink = document.getElementById('trending-link');
        const popularLink = document.getElementById('popular-link');
        const exploreBtn = document.getElementById('explore-btn');
        const categoryLinks = document.querySelectorAll('.category-link');
        const videoPlayer = document.getElementById('video-player');
        const prevEpisodeBtn = document.getElementById('prev-episode');
        const nextEpisodeBtn = document.getElementById('next-episode');
        const serverList = document.getElementById('server-list');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadRecentAnime();
            
            // Event Listeners
            searchBtn.addEventListener('click', handleSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleSearch();
            });
            
            homeLink.addEventListener('click', function(e) {
                e.preventDefault();
                loadRecentAnime();
            });
            
            trendingLink.addEventListener('click', function(e) {
                e.preventDefault();
                loadRecentAnime();
            });
            
            popularLink.addEventListener('click', function(e) {
                e.preventDefault();
                loadPopularAnime();
            });
            
            exploreBtn.addEventListener('click', function(e) {
                e.preventDefault();
                loadPopularAnime();
            });
            
            // Category navigation
            categoryLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active category
                    categoryLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    const category = this.getAttribute('data-category');
                    currentCategory = category;
                    currentPage = 1;
                    
                    // Load category data
                    switch(category) {
                        case 'recent':
                            loadRecentAnime();
                            break;
                        case 'ongoing':
                            loadOngoingAnime();
                            break;
                        case 'completed':
                            loadCompletedAnime();
                            break;
                        case 'popular':
                            loadPopularAnime();
                            break;
                        case 'movies':
                            loadMoviesAnime();
                            break;
                        case 'batch':
                            loadBatchAnime();
                            break;
                    }
                });
            });
            
            // Episode navigation
            prevEpisodeBtn.addEventListener('click', playPreviousEpisode);
            nextEpisodeBtn.addEventListener('click', playNextEpisode);
        });

        // =====================================================================
        // PERUBAHAN 2: Fungsi fetchAPI dimodifikasi untuk memanggil proxy
        // =====================================================================
        async function fetchAPI(endpoint) {
            showLoading();
            hideError();
            try {
                // 'endpoint' contohnya: "/recent?page=1"
                // Kita ubah menjadi: "/api/get?path=/recent&page=1"

                // 1. Pisahkan path dari query params
                const [path, queryString] = endpoint.split('?');
                
                // 2. Buat URL baru ke proxy kita
                // (window.location.origin) mengambil domain Anda saat ini, cth: https://project-anda.vercel.app
                const url = new URL(API_BASE_URL, window.location.origin);
                
                // 3. Tambahkan path utama (cth: /recent) sebagai parameter 'path'
                url.searchParams.append('path', path);
                
                // 4. Tambahkan query params asli (cth: page=1)
                if (queryString) {
                    new URLSearchParams(queryString).forEach((value, key) => {
                        url.searchParams.append(key, value);
                    });
                }

                // 5. Panggil URL yang sudah diformat
                // Contoh URL jadinya: /api/get?path=/recent&page=1
                const response = await fetch(url); 
                
                if (!response.ok) {
                    throw new Error(`Network response was not ok (${response.status})`);
                }
                
                const data = await response.json();
                hideLoading();
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
                showError('Gagal memuat data. Silakan coba lagi.');
                hideLoading();
                return null;
            }
        }
        // =====================================================================
        // Akhir dari perubahan
        // =====================================================================

        async function loadRecentAnime() {
            const data = await fetchAPI(`/recent?page=${currentPage}`);
            if (data) {
                displayAnimeList(data.anime || data.data || data, 'Anime Terbaru');
                updatePagination(data);
            }
        }

        async function loadOngoingAnime() {
            const data = await fetchAPI(`/ongoing?page=${currentPage}`);
            if (data) {
                displayAnimeList(data.anime || data.data || data, 'Anime Sedang Tayang');
                updatePagination(data);
            }
        }

        async function loadCompletedAnime() {
            const data = await fetchAPI(`/completed?page=${currentPage}`);
            if (data) {
                displayAnimeList(data.anime || data.data || data, 'Anime Selesai');
                updatePagination(data);
            }
        }

        async function loadPopularAnime() {
            const data = await fetchAPI(`/popular?page=${currentPage}`);
            if (data) {
                displayAnimeList(data.anime || data.data || data, 'Anime Populer');
                updatePagination(data);
            }
        }

        async function loadMoviesAnime() {
            const data = await fetchAPI(`/movies?page=${currentPage}`);
            if (data) {
                displayAnimeList(data.anime || data.data || data, 'Anime Movie');
                updatePagination(data);
            }
        }

        async function loadBatchAnime() {
            const data = await fetchAPI(`/batch?page=${currentPage}`);
            if (data) {
                displayAnimeList(data.anime || data.data || data, 'Batch Anime');
                updatePagination(data);
            }
        }

        async function searchAnime(query) {
            const data = await fetchAPI(`/search?q=${encodeURIComponent(query)}&page=${currentPage}`);
            if (data) {
                displayAnimeList(data.anime || data.data || data, `Hasil Pencarian: ${query}`);
                updatePagination(data);
            }
        }

        async function fetchAnimeDetail(animeId) {
            const data = await fetchAPI(`/anime/${animeId}`);
            return data;
        }

        async function fetchEpisodeDetail(episodeId) {
            const data = await fetchAPI(`/episode/${episodeId}`);
            return data;
        }

        async function fetchServerDetail(serverId) {
            const data = await fetchAPI(`/server/${serverId}`);
            return data;
        }

        // UI Functions
        function showLoading() {
            loadingElement.style.display = 'block';
            animeListSection.style.display = 'none';
            animeDetailSection.style.display = 'none';
            playerSection.style.display = 'none';
            paginationElement.style.display = 'none';
        }

        function hideLoading() {
            loadingElement.style.display = 'none';
            animeListSection.style.display = 'block';
            paginationElement.style.display = 'flex';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        function displayAnimeList(animeList, title = 'Anime') {
            currentAnimeList = animeList;
            sectionTitle.innerHTML = `${title} <a href="#" class="view-all" id="view-all">Lihat Semua</a>`;
            animeGrid.innerHTML = '';
            
            if (!animeList || animeList.length === 0) {
                animeGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">Tidak ada anime yang ditemukan.</p>';
            } else {
                animeList.forEach(anime => {
                    const animeCard = document.createElement('div');
                    animeCard.className = 'anime-card';
                    animeCard.innerHTML = `
                        <img src="${anime.image || anime.poster || 'https://via.placeholder.com/200x280/333/666?text=No+Image'}" alt="${anime.title}">
                        <div class="anime-info">
                            <h3>${anime.title}</h3>
                            <p>${anime.type || 'TV'} â€¢ ${anime.episode || anime.episodes || '?'} Episode</p>
                            <div class="anime-meta">
                                <span class="episode-badge">${anime.episode || 'EP'}</span>
                                ${anime.score ? `<span class="score-badge">${anime.score}</span>` : ''}
                            </div>
                        </div>
                    `;
                    animeCard.addEventListener('click', () => showAnimeDetail(anime.id || anime.slug || anime.title));
                    animeGrid.appendChild(animeCard);
                });
            }
            
            animeListSection.style.display = 'block';
            animeDetailSection.style.display = 'none';
            playerSection.style.display = 'none';
        }

        function updatePagination(data) {
            paginationElement.innerHTML = '';
            
            if (!data.pagination) return;
            
            const { currentPage: page, hasNextPage, totalPages } = data.pagination;
            
            // Previous button
            const prevBtn = document.createElement('div');
            prevBtn.className = `page-btn ${page <= 1 ? 'disabled' : ''}`;
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            if (page > 1) {
                prevBtn.addEventListener('click', () => {
                    currentPage = page - 1;
                    loadCurrentCategory();
                });
            }
            paginationElement.appendChild(prevBtn);
            
            // Page numbers
            for (let i = Math.max(1, page - 2); i <= Math.min(totalPages, page + 2); i++) {
                const pageBtn = document.createElement('div');
                pageBtn.className = `page-btn ${i === page ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    loadCurrentCategory();
                });
                paginationElement.appendChild(pageBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('div');
            nextBtn.className = `page-btn ${!hasNextPage ? 'disabled' : ''}`;
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            if (hasNextPage) {
                nextBtn.addEventListener('click', () => {
                    currentPage = page + 1;
                    loadCurrentCategory();
                });
            }
            paginationElement.appendChild(nextBtn);
        }

        function loadCurrentCategory() {
            switch(currentCategory) {
                case 'recent':
                    loadRecentAnime();
                    break;
                case 'ongoing':
                    loadOngoingAnime();
                    break;
                case 'completed':
                    loadCompletedAnime();
                    break;
                case 'popular':
                    loadPopularAnime();
                    break;
                case 'movies':
                    loadMoviesAnime();
                    break;
                case 'batch':
                    loadBatchAnime();
                    break;
            }
        }

        async function showAnimeDetail(animeId) {
            const anime = await fetchAnimeDetail(animeId);
            if (!anime) return;
            
            currentAnimeDetail = anime;
            
            // Update UI with anime details
            document.getElementById('detail-poster').src = anime.image || anime.poster || 'https://via.placeholder.com/300x450/333/666?text=No+Image';
            document.getElementById('detail-title').textContent = anime.title;
            document.getElementById('detail-type').textContent = anime.type || 'Unknown';
            document.getElementById('detail-episodes').textContent = `${anime.totalEpisodes || anime.episodes || '?'} Episode`;
            document.getElementById('detail-status').textContent = anime.status || 'Unknown';
            document.getElementById('detail-score').textContent = anime.score || 'N/A';
            document.getElementById('detail-synopsis').textContent = anime.synopsis || 'Tidak ada sinopsis tersedia.';
            
            // Update genres
            const genresContainer = document.getElementById('detail-genres');
            genresContainer.innerHTML = '';
            if (anime.genres && anime.genres.length > 0) {
                anime.genres.forEach(genre => {
                    const genreTag = document.createElement('span');
                    genreTag.className = 'genre-tag';
                    genreTag.textContent = genre;
                    genresContainer.appendChild(genreTag);
                });
            }
            
            // Update episodes
            const episodeGrid = document.getElementById('episode-grid');
            episodeGrid.innerHTML = '';
            
            if (anime.episodes && anime.episodes.length > 0) {
                currentEpisodes = anime.episodes;
                
                anime.episodes.forEach((episode, index) => {
                    const episodeCard = document.createElement('div');
                    episodeCard.className = 'episode-card';
                    episodeCard.textContent = `Episode ${episode.number || index + 1}`;
                    episodeCard.addEventListener('click', () => playEpisode(index));
                    episodeGrid.appendChild(episodeCard);
                });
            } else {
                episodeGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">Tidak ada episode yang tersedia.</p>';
            }
            
            animeListSection.style.display = 'none';
            animeDetailSection.style.display = 'block';
            playerSection.style.display = 'none';
            
            // Scroll to detail section
            animeDetailSection.scrollIntoView({ behavior: 'smooth' });
        }

        async function playEpisode(episodeIndex) {
            if (!currentEpisodes.length) return;
            
            currentEpisodeIndex = episodeIndex;
            const episode = currentEpisodes[episodeIndex];
            
            // Update player title
            document.getElementById('player-title').textContent = 
                `${currentAnimeDetail.title} - Episode ${episode.number || episodeIndex + 1}`;
            
            // Fetch episode details to get servers
            const episodeDetail = await fetchEpisodeDetail(episode.id || episode.slug);
            if (episodeDetail && episodeDetail.servers) {
                currentServers = episodeDetail.servers;
                updateServerList();
                
                // Auto-select first server
                if (currentServers.length > 0) {
                    selectServer(currentServers[0].id);
                }
            }
            
            // Update episode navigation buttons
            updateEpisodeNavigation();
            
            animeListSection.style.display = 'none';
            animeDetailSection.style.display = 'none';
            playerSection.style.display = 'block';
            
            // Scroll to player
            playerSection.scrollIntoView({ behavior: 'smooth' });
        }

        function updateServerList() {
            serverList.innerHTML = '';
            
            currentServers.forEach(server => {
                const serverBtn = document.createElement('div');
                serverBtn.className = 'server-btn';
                serverBtn.textContent = server.name || `Server ${server.id}`;
                serverBtn.addEventListener('click', () => selectServer(server.id));
                serverList.appendChild(serverBtn);
            });
        }

        async function selectServer(serverId) {
            // Update active server button
            const serverButtons = serverList.querySelectorAll('.server-btn');
            serverButtons.forEach(btn => btn.classList.remove('active'));
            
            const selectedBtn = Array.from(serverButtons).find(btn => 
                btn.textContent.includes(serverId) || btn.textContent.includes('Server')
            );
            if (selectedBtn) selectedBtn.classList.add('active');
            
            // Fetch server details to get embed URL
            const serverDetail = await fetchServerDetail(serverId);
            if (serverDetail && serverDetail.embed) {
                videoPlayer.src = serverDetail.embed;
            }
        }

        function updateEpisodeNavigation() {
            // Enable/disable previous episode button
            prevEpisodeBtn.disabled = currentEpisodeIndex <= 0;
            
            // Enable/disable next episode button
            nextEpisodeBtn.disabled = currentEpisodeIndex >= currentEpisodes.length - 1;
        }

        async function playNextEpisode() {
            if (currentEpisodeIndex < currentEpisodes.length - 1) {
                await playEpisode(currentEpisodeIndex + 1);
            }
        }

        async function playPreviousEpisode() {
            if (currentEpisodeIndex > 0) {
                await playEpisode(currentEpisodeIndex - 1);
            }
        }

        // Search Function
        async function handleSearch() {
            const query = searchInput.value.trim();
            if (!query) return;
            
            currentCategory = 'search';
            currentPage = 1;
            await searchAnime(query);
        }
    </script>
</body>
</html>
